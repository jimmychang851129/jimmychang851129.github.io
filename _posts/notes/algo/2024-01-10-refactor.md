---
layout: post
title:  "Refactor"
date:   2024-01-10 21:44:00
categories: Algorithm
tags: Course
---

### 宗旨

這篇文章宗旨在紀錄如何處理legacy code, 對公司內的legacy code, 維護成本過高(因為沒人看得懂, 很難改得動). 因此記錄一些Refactor技巧讓legacy code能夠變得更好維護以及擴充

### Reference

[Refactor Guru](https://refactoring.guru/extract-class)


### Long Method 處理法

legacy code往往因為各種擴充而使method變得非常長而難以閱讀維護.

#### 修改方法

**Extract Method**<br />
盡量讓每個method都不要太長, 當一個method/function發現寫的行數變多時, 可以把他extract成另一個function, 盡量讓每一個function只做一件事. 並且透過良好的命名來避免comment這個function的目的,  這樣會有點functional programming的風格, 一個function內其實就是不斷的call function來完成各種事, 而function name又可以知道這function在幹嘛.

一些小細節<br />
1. 盡量避免出現stateful的狀況, 否則之後很難debug, 例如裡面使用到static, 或者修改某些global, heap裡面的值, 如果extract出來的method是stateless, 那他是很珍貴的. 
2. function argument不要太雜太針對,越general越好, 因為這樣會變成要call這function不但不容易(要先建好很多的變數, 很多變數可能到後來也不知道是幹嘛的), 另一方面會出現這種狀況就是沒做好封裝, 封裝應該要有一個好的interface來讓使用者使用該function.

Duplicate code會導致bug fix的時候要找到程式碼裡所有這個邏輯的地方都fix, 這很容易遺漏掉, 也不好維護. extract method也能避免duplicate code,之後要維護也相對簡單一些, 反正他就做簡單的事, 邏輯也沒有散落各地.

**不過度依賴comment**<br />
雖然comment能夠介紹此code在幹嘛, 但comment在維護上也是成本, 因此comment多用於function declaration定義input/output以及一些注意事項(.h檔內), 在definition地方能夠的話盡量少用comment, 不然會擔心之後出現錯誤的comment, 與程式不符的comment, 或者根本不知道在幹嘛的comment.

1. 除非code難以看懂, 否則不用特地comment這段code在幹嘛(大家都很聰明的)
2. 更重要的事,為何要加這段code. 如果沒註解為何加這段code,以後維護的人, 如果想對這段code做修改, 例如看到這段code裡有怪怪的地方, 因爲沒辦法確定創始人的意圖, 沒辦法確定是不是能移掉或修改這段code.

### Large Class

Class同method/ function遇到的狀況, 因為功能越加越多, 所以class到後來都非常巨大

#### 修改方法

**Extract class**<br />
一個class盡量也不要太多的功能, 多餘的功能, 或者可拆的功能把它拆到另一個class, 然後這兩個class盡量只有單向dependency(雙向也可以, 但單向整個code的coupling比較小)

**Extract subclass**<br />
在class裡面, 常常會有很多if/else專門處理某種edge case,特殊情況（例如某個field值等於多少時才走某段code),如果再多個method裡面都有同樣的狀況時, code會變得非常難懂. 因此對於這些edge case/ corner case可以使用繼承parent class的方式, 把這些if else的edge case改成sub class(derived class)處理, 這樣分工就更精細好讀.
